// problem url: https://www.codingninjas.com/codestudio/problems/759332?topList=striver-sde-sheet-problems&utm_source=striver&utm_medium=website&leftPanelTab=1
// mode: Hard
// Recursion and backtracking

#include <bits/stdc++.h>

bool doesNotIntersectDiagonally(int row, int col, vector<int> &posWithQueen){
    int size = posWithQueen.size();
    
    for(int i=0; i<size; i++)
        if( (col==(posWithQueen[i]-(row-i))) || (col==(posWithQueen[i]+(row-i))) )
            return false;
    
    return true;
}

void findQueenPos(int n, int row, vector<int> &posWithQueen, unordered_map<int,bool> &queenPresentAtIndex, vector<vector<vector<int>>> &tempAns){
    if(n==row){
        vector<vector<int>> conf;
        for(int pos: posWithQueen){
            vector<int> rowConf = vector<int>(n,0);
            rowConf[pos] = 1;
            conf.push_back(rowConf);
        }
        tempAns.push_back(conf);
        return;
    }
    
    for(int i=0; i<n; i++){
        if(!queenPresentAtIndex[i] && doesNotIntersectDiagonally(row,i,posWithQueen)){
            posWithQueen.push_back(i);
            queenPresentAtIndex[i] = true;
            findQueenPos(n, row+1, posWithQueen, queenPresentAtIndex, tempAns);
            posWithQueen.pop_back();
            queenPresentAtIndex[i] = false;
        }
    }
}

vector<vector<int>> solveNQueens(int n) {
    vector<int> posWithQueen;
    unordered_map<int,bool> queenPresentAtIndex;
    vector<vector<vector<int>>> tempAns;
    findQueenPos(n,0,posWithQueen,queenPresentAtIndex,tempAns);
    
    vector<vector<int>> ans;
    for(auto conf: tempAns){
        vector<int> tempRow;
        for(auto row: conf)
            for(int num: row)
                tempRow.push_back(num);
        ans.push_back(tempRow);
    }
    return ans;
}
